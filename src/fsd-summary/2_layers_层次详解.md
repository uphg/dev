# layers (层次) 详解

## 各层职责清晰划分

### 1. **Shared（共享层）** - 技术基础设施
**定位**：应用的技术基础，与业务无关
```
shared/
├── api/          # API 客户端配置
├── ui/           # UI 组件库（按钮、输入框等）
├── lib/          # 工具库（日期处理、字符串处理等）
├── config/       # 环境变量、全局配置
└── routes/       # 路由配置
```

**特点**：高度可复用，无业务逻辑

### 2. **Entities（实体层）** - 业务概念模型
**定位**：核心业务实体，代表业务领域的概念
```
entities/
├── user/         # 用户实体
│   ├── ui/       # 用户头像、信息展示组件
│   ├── model/    # 用户数据类型、验证规则
│   └── api/      # 用户相关 API
├── product/      # 商品实体
└── order/        # 订单实体
```

**特点**：跨功能复用，代表业务"名词"

### 3. **Features（特性层）** - 用户价值功能
**定位**：用户关心的具体交互功能
```
features/
├── user-auth/    # 用户认证
│   ├── ui/       # 登录表单
│   ├── model/    # 认证状态管理
│   └── api/      # 登录/注册 API 调用
├── add-to-cart/  # 加入购物车
└── search/       # 搜索功能
```

**关键原则**：不是所有东西都是 feature，要有复用价值

### 4. **Widgets（部件层）** - 大型UI区块
**定位**：自包含的大型UI块，组合多个功能
```
widgets/
├── header/           # 顶部导航
├── product-grid/     # 商品网格
├── shopping-cart/    # 购物车侧边栏
└── user-profile/     # 用户资料卡
```

**使用场景**：
- 跨页面复用
- 页面中独立的复杂区块
- 嵌套路由中的完整路由块

### 5. **Pages（页面层）** - 完整页面
**定位**：用户访问的完整页面/屏幕
```
pages/
├── home/            # 首页
├── product/         # 商品详情页
├── cart/            # 购物车页面
└── profile/         # 个人资料页
```

**特点**：可以包含不复用的UI组件

### 6. **App（应用层）** - 应用全局配置
**定位**：应用运行所需的基础设施
```
app/
├── routes/          # 路由配置
├── store/           # 全局状态配置
├── styles/          # 全局样式
└── providers/       # 上下文提供者
```

## 依赖关系规则

**严格的自上而下依赖**：
```
Pages → Widgets → Features → Entities → Shared
    ↘___________→___________→_________→_______↘
```

**禁止**：
- 同层之间的相互引用
- 下层引用上层

## 实际项目结构示例

### 电商项目案例
```
src/
├── app/
│   ├── routes/                 # 路由配置
│   └── providers/             # Redux/React Query 配置
├── pages/
│   ├── home/                  # 首页
│   ├── product/               # 商品页
│   └── cart/                  # 购物车页
├── widgets/
│   ├── header/                # 顶部导航（包含搜索、用户菜单）
│   ├── product-grid/          # 商品网格
│   └── shopping-cart-sidebar/ # 购物车侧边栏
├── features/
│   ├── search/                # 搜索功能
│   ├── add-to-cart/           # 加入购物车
│   ├── user-auth/             # 用户认证
│   └── product-favorites/     # 商品收藏
├── entities/
│   ├── user/                  # 用户实体
│   ├── product/               # 商品实体
│   └── cart/                  # 购物车实体
└── shared/
    ├── ui/                    # UI 组件库
    ├── api/                   # API 客户端
    └── lib/                   # 工具函数
```

## 核心设计原则

1. **责任分离**：每层有明确的职责范围
2. **复用性梯度**：从下到上，复用性递减，业务性递增
3. **依赖控制**：严格的下行依赖，避免循环依赖
4. **可发现性**：通过分层快速定位代码

## 实践建议

**最小必要分层**：
- 小型项目：`app/` + `pages/` + `shared/`
- 中型项目：增加 `features/` 和 `entities/`
- 大型项目：完整七层结构

这样的分层确保了代码的可维护性、可测试性和团队协作效率。